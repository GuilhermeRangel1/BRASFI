<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRASFI</title>
    
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="/css/comunidades.css"/>
   
    <link rel="stylesheet" href="/webjars/bootstrap/5.3.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="icon" type="image/jpg" href="img/brasfi.jpg">
    
    <script th:inline="javascript">
        let comunidadeId = 0; 
    </script>
    <script type="module" src="/js/comunidade.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.0.0/bundles/stomp.umd.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    
    <script th:src="@{/js/inicio.js}"></script> 

    <script>
        function OpenForm()
        {
            document.getElementById("criar-comunidade").style.display = "block";
        }
    </script>

</head>
<body>
  <header>
    <div class="top-bar">
      <div class="logo-section">
        <div class="brasfi-logo">BRASFI</div>
        <img th:src="@{/img/brasfi.jpg}" alt="Logo BRASFI" class="brasfi-icon">
      </div>
      <div class="user-section">
        <div sec:authorize="isAuthenticated()" class="logged-in-container">
          <span class="logged-in-username"><i class="fas fa-star"></i> <span sec:authentication="principal.name">Nome do Usuário</span> <span class="user-icon"><i class="fas fa-user-circle"></i></span></span>
          <a th:href="@{/logout}" class="logout-button">Sair</a> </div>
        <a sec:authorize="!isAuthenticated()" th:href="@{/login}" class="login-button">Login</a>
      </div>
    </div>

    <div class="menu-container">
        <div class="menu-toggle-bar">
            <button class="menu-open-button" id="menu-open-button">
                <i class="fas fa-angle-down"></i>
            </button>
        </div>
        <ul class="menu" id="main-menu">
            <button class="menu-close-button" id="menu-close-button">
                <i class="fas fa-angle-up"></i>
            </button>
            <li><a th:href="@{/}">Home</a></li>
            <li><a th:href="@{/sobre}">Sobre a BRASFI</a></li>
            <li><a th:href="@{/agenda}">Agenda de Eventos</a></li>
            <li><a th:href="@{/eventosGravados}">Eventos Gravados</a></li>
            <li><a th:href="@{/comunidades}">Comunidade</a></li>
        </ul>
    </div>
  </header>

  <div class="chat-layout-container">
      
      <div class="left-sidebar">
          <div class="sidebar-header-left">
              <h3>COMUNIDADES</h3>
          </div>
      </div>

      <main class="chat-main-content">
          <div class="chat-header-area">
              </div>

          <div class="chat-messages-area">
              <div th:each="post: ${postagens}" class="message-bubble" 
                   th:classappend="${post.currentUser ? 'my-message' : 'other-message'}">
                   <div class="user-avatar">
                      <i class="fas fa-user-circle"></i> </div>
                  <div class="message-content">
                      <p th:text="${post.getDescricao()}"></p>
                  </div>
              </div>
          </div>

          <div class="chat-input-area">
              <div class="input-and-button-container">
                <input type="text" id="message" placeholder="Escreva uma mensagem...">
                <button id="send" type="submit"><i class="fas fa-play"></i></button>
              </div>
          </div>
      </main>

      <div class="right-sidebar">
          <div class="edit-section">
              <a href="#" class="edit-communities-button">+ Editar</a> 
          </div>
          <div class="community-list-section">
              <ul class="community-list">
                  <li th:each="com : ${comunidades}" 
                      th:class="${com != null and (com.id == comunidade.id) ? 'active-community' : ''}">
                      <a th:href="@{/comunidades/{id}(id=${com.getId()})}" th:text="${com.nome}"></a>
                  </li>
                  </ul>
          </div>
      </div>

  </div> <button onclick="OpenForm()" id="open-criar-comunidade" style="display: none;">Criar nova comunidade</button>

  <div id="criar-comunidade" style="display: none">
      <div class="d-flex justify-content-center align-items-center vh-100">
          <form action="/criar-comunidade" method="post" id="criar-comunidade-form" class="p-4 border rounded bg-light shadow">
              <div class="mb-3">
                  <label for="nome" class="form-label">Nome</label>
                  <input type="text" class="form-control" id="nome" name="nome" placeholder="Digite o nome" required>
              </div>

              <div class="mb-3">
                  <label for="descricao" class="form-label">Descrição</label>
                  <textarea class="form-control" id="descricao" name="descricao" rows="4" placeholder="Descreva a comunidade"></textarea>
              </div>
              <label class="form-label">Integrantes da comunidade</label>
              <div class="mb-3">
                  <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" id="Publica" name="Nivel de Permissao" th:value="${PUBLICA}">
                      <label class="form-check-label" for="Publica">Pública</label>
                  </div>
                  <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" id="Lideres" name="Nivel de Permissao" th:value="${APENAS_LIDERES}">
                      <label class="form-check-label" for="Lideres">Apenas líderes</label>
                  </div>
                  <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" id="Personalizada" name="Nivel de Permissao" th:value="${PERSONALIZADA}">
                      <label class="form-check-label" for="Personalizada">Personalizada</label>
                  </div>
              </div>

              <button type="submit" class="btn btn-primary w-100">Criar</button>
          </form>
      </div>
  </div>

    <script src="/webjars/jquery/3.7.1/jquery.min.js"></script>
    <script src="/webjars/bootstrap/5.3.3/js/bootstrap.min.js"></script>
</body>
</html>